<!DOCTYPE html>
<html>
  	<head>
	    <title>{{ title }}</title>
	    <link rel='stylesheet' href='/bower_components/bootstrap/dist/css/bootstrap.min.css' />
	    <link rel='stylesheet' href='/bower_components/bootstro/bootstro.min.css' />
	    <link rel='stylesheet' href='/stylesheets/cstree.css'/>
	    <link rel='stylesheet' href='/bower_components/jquery-ui/themes/smoothness/jquery-ui.min.css' />

	    <script src="/javascripts/turkify.js"></script>
	    <script src="/javascripts/cstree.js"></script>
	    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
	    <script src="/bower_components/jquery-ui/jquery-ui.min.js"></script>
	    <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	    <script src="/bower_components/bootstro/bootstro.min.js"></script>
	    <script src="/bower_components/underscore/underscore-min.js"></script>
	    <script src="/bower_components/bootbox/bootbox.js"></script>
	    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
	    <script src="/bower_components/angular/angular.min.js"></script>
	    <script src="/bower_components/d3/d3.js"></script>	

	    <script type="text/javascript">

	    	var app = angular.module('myApp', [], function($interpolateProvider) {
				$interpolateProvider.startSymbol('<%');
				$interpolateProvider.endSymbol('%>');
			});

			app.controller('myCtrl', function($scope, $http) {
				//load data
				$scope.selected = null;
				$scope.programs = [];
				$http.get('/socialdoi/budgets')
				.success(function(res){
									
					
				    $scope.budgets = res;
				    var config = {
				    	container: "#chart",
				    	data: $scope.budgets,
				    	margin: {top: 20, right: 0, bottom: 20, left: 150},
				    	width : 700,
				    	height : 600,
				    	onClick: function(d){
				    		$scope.$apply(function(){
				    			$scope.selected = d;
				    			console.log($scope.selected.name);
				    		});
				    	}
				    };

				    var cstree = CSTree(config);
                	cstree.create();


				});
				$scope.Add = function(){
			    	console.log("add")
			    	if ($scope.selected==null || $scope.selected.program==null){
			    		$("#addWarning").effect( "shake" );
			    		return;
			    	}
			    	if (_.contains($scope.programs, $scope.selected)){
			    		bootbox.alert("WARNING: The selected program already exists!");
			    		return;
			    	}
			    	$scope.programs.push($scope.selected);
			    }
			    $scope.Remove = function(idx) {
			    	$scope.programs.splice(idx, 1);
			    }
				$scope.Finish = function(){
			    	if ($scope.programs.length<5){
			    		$("#finishWarning").show().effect( "shake" ).delay(1000).toggle( "fade" );
			    		return;
			    	}
			    	console.log($scope.programs);
			    	
			    }
			});
	    </script>
  	</head>
  	<body ng-app="myApp" ng-controller="myCtrl">
  		<div class="container" style="margin:10px">
  		<div class="row">
  			<div class="col-md-8">
				<div id="chart"></div>	
  			</div>
  			<div class="col-md-4">
				<div class="panel panel-primary">
					<div class="panel-heading">
				    	<h3 class="panel-title"><% budgets.name %></h3>
				  	</div>
					<div class="panel-body">
						<div class="panel panel-default">
  							<div class="panel-body">
								<div id="addWarning" class="alert alert-danger" role="alert" ng-if="selected.program==null">
									<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> Select a Budget Program!</div>
								<div class="alert alert-success" role="alert" ng-if="selected.program!=null">
									<span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Good Job! If you find this program interesting, please add it to the list!</div>
								<table class="table table-condensed">
								  <tr>
								  	<td>Cabinet</td>
								  	<td><% selected.cabinet %></td>
								  </tr>
								  <tr>
								  	<td>Department</td>
								  	<td><% selected.department %></td>
								  </tr>
								  <tr>
								  	<td>Program</td>
								  	<td>
							  			<strong><% selected.program %></strong>
							  		</td>
								  </tr>
								  <tr>
								  	<td>Budget</td>
								  	<td>
							  			<strong><% selected.approved | currency:"$ ":0%></strong>
							  		</td>
								  </tr>
								</table>
							    <button type="button" style="width:100%" class="btn btn-info" aria-label="Left Align" ng-click="Add()">
								  	<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add
								</button>
							  </div>
							</div>
						</div>
						<center class="lead">Programs of Interest</center>
						<table class="table" style="text-align:center"	>
							<thead><tr><td><strong>#</strong></td><td ><strong>Program</strong></td></tr></thead>
							<tbody>
								<tr ng-repeat="x in programs">
									<td><% $index+1 %></td>
									<td><% x.program %><button type="button" class="btn btn-info btn-xs" style="float:right"  aria-label="Left Align" ng-click="Remove(x)">
								  	<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
								</button>
									</td>
								</tr>
								<tr>
									<td colspan="2">
										<div id="finishWarning" style="display:none" class="alert alert-danger" role="alert">
									<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>Please add at least five programs!</div>
										<button type="button" style="width:100%" class="btn btn-success" aria-label="Left Align" ng-click="Finish()"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Finish
										</button>
									</td>
								</tr>
							</tbody>							
						</table>
						
						
						
					</div>
				</div>
  			</div>
  			
		</div>
		</div>
  	</body>
</html>